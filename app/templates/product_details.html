{% extends 'base.html' %}

{% block content %}
  <h1>Product Details</h1>
  <h2>{{ product.name }}</h2>
  <img src="{{ product.image }}" alt="{{ product.name }} Image" />
  <p>Price: ${{ product.price }}</p>
  <p>{{ product.description }}</p>

  <!-- Modal for PayPal Checkout -->
  <div id="paypalModal" class="modal">
    <div class="modal-content">
      <h3>Checkout with PayPal</h3>
      <p>Product: {{ product.name }}</p>
      <p>Price: ${{ product.price }}</p>
      <div id="paypal-button-container"></div>
    </div>
  </div>
  <button type="button" id="paypalButton" class="modal-trigger">Buy with PayPal</button>

  <script>
    // Add JavaScript to trigger modals and PayPal integration
    const paypalModal = document.getElementById('paypalModal')
    const paypalButton = document.getElementById('paypalButton')
    
    paypalButton.addEventListener('click', () => {
      paypalModal.style.display = 'block'
    
      // Render PayPal button using the PayPal SDK
      paypal
        .Buttons({
          createOrder: function (data, actions) {
            return actions.order.create({
              purchase_units: [
                {
                  amount: {
                    value: '{{ product.price }}'
                  }
                }
              ]
            })
          },
          onApprove: function (data, actions) {
            // Capture the transaction details
            return actions.order.capture().then(function (details) {
              // You can handle successful payment here
              alert('Payment successful! Transaction ID: ' + details.id)
            })
          }
        })
        .render('#paypal-button-container')
    })
    
    // Close the PayPal modal if clicked outside
    window.addEventListener('click', (event) => {
      if (event.target === paypalModal) {
        paypalModal.style.display = 'none'
      }
    })
  </script>

  <!-- Modal for Flutterwave Checkout -->
  <div id="flutterwaveModal" class="modal">
    <div class="modal-content">
      <h3>Checkout with Flutterwave</h3>
      <p>Product: {{ product.name }}</p>
      <p>Price: ${{ product.price }}</p>
      <!-- Add Flutterwave checkout integration here -->
    </div>
  </div>
  <button type="button" id="flutterwaveButton" class="modal-trigger">Buy with Flutterwave</button>

  <script>
    // Add JavaScript to trigger modals
    const paypalModal = document.getElementById('paypalModal')
    const flutterwaveModal = document.getElementById('flutterwaveModal')
    const paypalButton = document.getElementById('paypalButton')
    const flutterwaveButton = document.getElementById('flutterwaveButton')
    
    paypalButton.addEventListener('click', () => {
      paypalModal.style.display = 'block'
    })
    
    flutterwaveButton.addEventListener('click', () => {
      flutterwaveModal.style.display = 'block'
    })
    
    // Close the modals if clicked outside
    window.addEventListener('click', (event) => {
      if (event.target === paypalModal) {
        paypalModal.style.display = 'none'
      } else if (event.target === flutterwaveModal) {
        flutterwaveModal.style.display = 'none'
      }
    })
  </script>
{% endblock %}
